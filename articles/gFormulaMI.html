<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gFormulaMI">
<title>gFormulaMI - G-formula for causal inference via multiple imputation • gFormulaMI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="gFormulaMI - G-formula for causal inference via multiple imputation">
<meta property="og:description" content="gFormulaMI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gFormulaMI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/gFormulaMI.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>gFormulaMI - G-formula for causal inference via multiple imputation</h1>
                        <h4 data-toc-skip class="author">Jonathan
Bartlett</h4>
            
      
      
      <div class="d-none name"><code>gFormulaMI.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we introduce the functionality of the
<code>gFormulaMI</code>. The package implements an approach to
constructing a G-formula estimator using multiple imputation methods and
software, as described by <a href="https://arxiv.org/abs/2301.12026" class="external-link">Bartlett et al (2023)</a>.</p>
<p>First we use the simulated dataset provided in the package to
demonstrate how to impute potential outcomes using
<code>gFormulaImpute</code>. We then show how the resulting imputed
datasets can be analysed using the <code>syntheticPool</code> function.
Lastly, we illustrate how the functions can be used when the dataset has
missing values to begin with (i.e. regular missing data).</p>
</div>
<div class="section level2">
<h2 id="imputing-using-gformulaimpute">Imputing using <code>gFormulaImpute</code><a class="anchor" aria-label="anchor" href="#imputing-using-gformulaimpute"></a>
</h2>
<p>First, we load the package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jwb133.github.io/gFormulaMI/">gFormulaMI</a></span><span class="op">)</span></span></code></pre></div>
<p>The first few rows of the simulated dataset that ships with the
package look like</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simDataFullyObs</span><span class="op">)</span></span>
<span><span class="co">#&gt;           l0 a0          l1 a1         l2 a2          y</span></span>
<span><span class="co">#&gt; 1 -0.6332580  1  0.59545963  1  2.7644551  1  3.4091077</span></span>
<span><span class="co">#&gt; 2  0.1182498  0  0.62444135  0 -0.9677095  1 -0.8586307</span></span>
<span><span class="co">#&gt; 3  0.4833364  1 -0.53836723  0 -0.7088896  0 -0.4378790</span></span>
<span><span class="co">#&gt; 4  0.6775931  0  0.57759241  1  2.0477487  1  3.8760967</span></span>
<span><span class="co">#&gt; 5  0.4278554  1  1.50188037  1  3.4155576  1  4.4027209</span></span>
<span><span class="co">#&gt; 6  0.6437421  1 -0.01322485  1  2.2178911  1  4.1302417</span></span></code></pre></div>
<p>Here the <code>l</code> variables correspond to a confounder measured
at baseline (<code>l0</code>) and two follow-up time points
(<code>l1</code> and <code>l2</code>). The time-varying binary treatment
variable is stored in <code>a0</code>, <code>a1</code> and
<code>a2</code>. The final outcome variable is <code>y</code>.</p>
<p>Next we use <code>gFormulaImpute</code> to impute potential outcomes
under two treatment regimes of interest. To do this,
<code>gFormulaImpute</code> uses the <code>mice</code> multiple
imputation function from the <code>mice</code> package. If passed a
regular data frame, as here, <code>gFormulaImpute</code> expects (and
requires) there to be no missing values in the data frame. To run, we
have to tell <code>gFormulaImpute</code> which variables correspond to
the time-varying treatment and the treatment regime(s) that we want it
to create imputations for:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7626</span><span class="op">)</span></span>
<span><span class="co">#impute synthetic datasets under two regimes of interest</span></span>
<span><span class="va">imps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gFormulaImpute.html">gFormulaImpute</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">simDataFullyObs</span>,M<span class="op">=</span><span class="fl">10</span>,trtVars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a0"</span>,<span class="st">"a1"</span>,<span class="st">"a2"</span><span class="op">)</span>,</span>
<span>                        trtRegimes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Input data is a regular data frame."</span></span>
<span><span class="co">#&gt; [1] "Variables imputed using:"</span></span>
<span><span class="co">#&gt;     l0     a0     l1     a1     l2     a2      y regime </span></span>
<span><span class="co">#&gt; "norm"     "" "norm"     "" "norm"     "" "norm"     "" </span></span>
<span><span class="co">#&gt; [1] "Predictor matrix is set to:"</span></span>
<span><span class="co">#&gt;        l0 a0 l1 a1 l2 a2 y regime</span></span>
<span><span class="co">#&gt; l0      0  0  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; a0      1  0  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; l1      1  1  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; a1      1  1  1  0  0  0 0      0</span></span>
<span><span class="co">#&gt; l2      1  1  1  1  0  0 0      0</span></span>
<span><span class="co">#&gt; a2      1  1  1  1  1  0 0      0</span></span>
<span><span class="co">#&gt; y       1  1  1  1  1  1 0      0</span></span>
<span><span class="co">#&gt; regime  1  1  1  1  1  1 1      0</span></span></code></pre></div>
<p>Here we have called <code>gFormulaImpute</code> requesting 10
imputations to be generated for two regimes of interest, corresponding
to no treatment at each time point (0,0,0) and treatment at each time
point (1,1,1).</p>
<div class="section level3">
<h3 id="imputation-model-specification">Imputation model specification<a class="anchor" aria-label="anchor" href="#imputation-model-specification"></a>
</h3>
<p>The printed output above tells us what imputation methods have been
used to impute (simulate) the time-varying confounders and outcome. By
default, <code>gFormulaImpute</code> specifies to impute numeric
variables using normal linear regression, which is why here
<code>l0</code>, <code>l1</code>, <code>l2</code> and <code>y</code> are
being imputed using method <code>norm</code>. If there had been binary
factors as time-varying confounders, these would be imputed using
logistic regression. Factor time-varying confounders which are unordered
are imputed using polytomous regression and a proportional odds model is
used for ordered factors. If you want to modify these defaults, you can
pass a <code>method</code> vector to <code>gFormulaImpute</code>, which
specifies which of the imputation methods available in the
<code>mice</code> package to use when imputing each column of the data
frame.</p>
<p>The output also shows the <code>predictorMatrix</code> argument used
when calling the <code>mice</code> imputation function. This shows, in a
given row, which other variables (indicated by a 1) will be used as
covariates in the imputation model for the variable labelled in that
row. Thus here, <code>l1</code> is being imputed using <code>l0</code>
and <code>a0</code>. For variables which are not being imputed (as
indicated by an empty entry in the vector of imputation methods
printed), the corresponding row in the predictor matrix has no effect on
anything. In particular, the treatment variables <code>a0</code>,
<code>a1</code> and <code>a2</code> are not being imputed based on a
regression model.</p>
<p>You will notice that the printed <code>predictorMatrix</code> has 1s
in the lower diagonal and 0s in the upper diagonal. This is because
g-formula and hence <code>gFormulaImpute</code>, imputes sequentially
forwards in time, using the past (i.e. to the left) variables as
covariates. Because of this, the data frame you pass to
<code>gFormulaImpute</code> must have the variables ordered in time as
in the example above, so that the correct covariates are used in each
model. If you wish to modify the predictor matrix used, you can pass a
custom one using the <code>predictorMatrix</code> argument of
<code>gFormulaImpute</code>.</p>
<p>Note that unlike in the usual missing data situation, no iteration is
required when <code>gFormulaImpute</code> calls the <code>mice</code>
imputation function, and thus when <code>gFormulaImpute</code> calls
<code>mice</code> it sets its <code>maxit</code> argument to 1.</p>
</div>
<div class="section level3">
<h3 id="number-of-imputations">Number of imputations<a class="anchor" aria-label="anchor" href="#number-of-imputations"></a>
</h3>
<p>In our call above we asked <code>gFormulaImpute</code> to create 10
imputations. Later when we analyse the imputations, the special pooling
rules we will apply can, with a small number of imputations, produce
negative variances for parameter estimates. To avoid this, we recommend
using at least 25 imputations in general (we used 10 here for the sake
of speed).</p>
</div>
<div class="section level3">
<h3 id="number-of-individuals-to-simulate">Number of individuals to simulate<a class="anchor" aria-label="anchor" href="#number-of-individuals-to-simulate"></a>
</h3>
<p>In our call above we did not specify the <code>nSim</code> argument.
This argument specifies how many individuals to simulate longitudinal
histories for in each of the synthetic imputed datasets. Since we did
not specify a value, the default is to simulate the same number as the
number of rows in the data frame passed to <code>gFormulaImpute</code>
(here 5,000). If more than one treatment regime is specified,
<code>nSim</code> rows are simulated for each regime.</p>
</div>
</div>
<div class="section level2">
<h2 id="analysing-the-imputations">Analysing the imputations<a class="anchor" aria-label="anchor" href="#analysing-the-imputations"></a>
</h2>
<p><code>gFormulaImpute</code> creates a set of synthetic imputed
datasets. That is, the imputed datasets created contain imputed
(simulated) longitudinal histories based on the fitted models, under the
treatment regimes specified. The original rows in the data frame passed
to <code>gFormulaImpute</code> do not appear in the imputed datasets
returned to us. The first few rows of the first imputed dataset are:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">imps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           l0 a0         l1 a1            l2 a2          y regime</span></span>
<span><span class="co">#&gt; 1  0.6177218  0  0.6397720  0 -0.0003761256  0  0.5996190      1</span></span>
<span><span class="co">#&gt; 2  0.2044563  0 -0.6073790  0 -1.7856679957  0 -1.7246571      1</span></span>
<span><span class="co">#&gt; 3  0.4327859  0 -0.3925652  0 -0.7555212806  0 -1.5840459      1</span></span>
<span><span class="co">#&gt; 4  0.6059553  0  2.4764117  0  0.7312018102  0  0.6342567      1</span></span>
<span><span class="co">#&gt; 5  0.2985589  0  0.9223022  0  0.0734605439  0 -1.1511625      1</span></span>
<span><span class="co">#&gt; 6 -0.1763264  0  0.6122369  0  0.8838681514  0  2.0858243      1</span></span></code></pre></div>
<p>We see that in the first rows of the first imputed dataset,
<code>a0</code>, <code>a1</code> and <code>a2</code> are always zero,
because the first treatment regime we specified to impute for was
(0,0,0). We also have an additional variable, called
<code>regime</code>. This factor variable records which of the specified
treatment regimes each row corresponds to. Thus here, in the first few
rows of the data frame, the regime is 1.</p>
<p>To analyse the imputed datasets we first run our desired analysis of
the imputed longitudinal histories. Here we will simply compare the mean
of the final outcome variable <code>y</code> between the two regimes we
have imputed for. To do this, we fit a linear model with <code>y</code>
as the dependent variable and <code>regime</code> as covariate:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">imps</span>, <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">regime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Because the imputed datasets we have analysed are fully synthetic, we
cannot (or rather should not) pool our estimates using Rubin’s standard
combination rules (e.g. as implemented in <code>pool</code> in the
<code>mice</code> package). Doing so results in variances which are
larger than they should be. Instead we use the synthetic imputation
combination rules developed by Raghunathan et al (2003), implemented in
the <code>syntheticPool</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/syntheticPool.html">syntheticPool</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    Estimate       Within     Between       Total       df</span></span>
<span><span class="co">#&gt; (Intercept)     -0.02071539 0.0008125695 0.001763004 0.001126735 3.038045</span></span>
<span><span class="co">#&gt; factor(regime)2  2.96593502 0.0016251389 0.004203106 0.002998278 3.784951</span></span>
<span><span class="co">#&gt;                   95% CI L   95% CI U            p</span></span>
<span><span class="co">#&gt; (Intercept)     -0.1267874 0.08535658 5.803156e-01</span></span>
<span><span class="co">#&gt; factor(regime)2  2.8104386 3.12143146 1.304839e-06</span></span></code></pre></div>
<p>Here the intercept corresponds to the mean of <code>y</code> under
our first regime (0,0,0). The <code>factor(regime)2</code> coefficient
corresponds to difference in the mean of <code>y</code> between the
second regime and the first. Here we see that the second regime has a
mean outcome about 3 higher than the first. As well as the point
estimate, we see the within, between and total imputation variances.
Here we can see that the total variances are less than the between,
which never happens with Rubin’s regular pooling rules. This is because
in the synthetic pooling rules of Raghunthan et al (2003), the total
variance is the between minus the within imputation variance (plus a
correction for the finite number of imputations performed).</p>
</div>
<div class="section level2">
<h2 id="datasets-with-missing-values">Datasets with missing values<a class="anchor" aria-label="anchor" href="#datasets-with-missing-values"></a>
</h2>
<p>Often the longitudinal dataset we have has some missing values. In
this context, one approach is to use multiple imputation to impute these
missing values using imputation software, assuming missing at random.
Having imputed these, we can then pass the imputed datasets to
<code>gFormulaImpute</code> to perform the synthetic imputation
step.</p>
<p>To illustrate these steps, let’s now create a new dataset from the
simulated one, making some values missing:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simDataMissing</span> <span class="op">&lt;-</span> <span class="va">simDataFullyObs</span></span>
<span><span class="va">simDataMissing</span><span class="op">$</span><span class="va">l0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">simDataMissing</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">simDataMissing</span><span class="op">$</span><span class="va">l1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">simDataMissing</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">simDataMissing</span><span class="op">$</span><span class="va">l2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">simDataMissing</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">simDataMissing</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">simDataMissing</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Here we have simply made around 20% of values missing in
<code>l0</code>, <code>l1</code>, <code>l2</code> and <code>y</code>,
completely randomly.</p>
<p>Next, we impute the <code>simDataMissing</code> data frame using the
<code>mice</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simDataMissingImps</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span><span class="va">simDataMissing</span>,m<span class="op">=</span><span class="fl">10</span>,printFlag<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In a real substantive analysis we should take more care to think
about how we specify the imputation models. For more discussion of this
point, see <a href="https://arxiv.org/abs/2301.12026" class="external-link">Bartlett et al
(2023)</a>. In particular, note that the default behaviour of the
<code>mice</code> function is to impute numeric variables using the
predictive mean matching method, rather than normal linear regression
(as in the <code>gFormulaImpute</code> function).</p>
<p>We can now pass our multiply imputed datasets to
<code>gFormulaImpute</code> to create the synthetic imputations as
before, but this time let’s try and generate 20 synthetic imputated
datasets:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imps2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gFormulaImpute.html">gFormulaImpute</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">simDataMissingImps</span>,M<span class="op">=</span><span class="fl">20</span>,trtVars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a0"</span>,<span class="st">"a1"</span>,<span class="st">"a2"</span><span class="op">)</span>,</span>
<span>                        trtRegimes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Input data is a mice created multiple imputation object."</span></span>
<span><span class="co">#&gt; [1] "Value passed to M being ignored."</span></span>
<span><span class="co">#&gt; [1] "Number of synthetic imputations to be generated set to 10 as in mids object passed to gFormulaImpute."</span></span>
<span><span class="co">#&gt; [1] "Variables imputed using:"</span></span>
<span><span class="co">#&gt;     l0     a0     l1     a1     l2     a2      y regime </span></span>
<span><span class="co">#&gt; "norm"     "" "norm"     "" "norm"     "" "norm"     "" </span></span>
<span><span class="co">#&gt; [1] "Predictor matrix is set to:"</span></span>
<span><span class="co">#&gt;        l0 a0 l1 a1 l2 a2 y regime</span></span>
<span><span class="co">#&gt; l0      0  0  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; a0      1  0  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; l1      1  1  0  0  0  0 0      0</span></span>
<span><span class="co">#&gt; a1      1  1  1  0  0  0 0      0</span></span>
<span><span class="co">#&gt; l2      1  1  1  1  0  0 0      0</span></span>
<span><span class="co">#&gt; a2      1  1  1  1  1  0 0      0</span></span>
<span><span class="co">#&gt; y       1  1  1  1  1  1 0      0</span></span>
<span><span class="co">#&gt; regime  1  1  1  1  1  1 1      0</span></span></code></pre></div>
<p>The output looks much the same as the first time we called
<code>gFormulaImpute</code>, apart from the first few lines of output.
<code>gFormulaImpute</code> can see that there are only 10 imputations
of the original dataset, and it refuses to generate a different number
of imputations to the number in the <code>mids</code> multiple
imputation dataset object we have passed to it. The <code>imps2</code>
object thus contains 10 imputations, which can be analysed using
<code>syntheticPool</code> in the same way as before.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bartlett JW, Olarte Parra C, Daniel RM. G-formula for causal
inference via multiple imputation. 2023 <a href="https://arxiv.org/abs/2301.12026" class="external-link">arXiv 2301.12026</a></p>
<p>Raghunathan TE, Reiter JP, Rubin DB. 2003. Multiple imputation for
statistical disclosure limitation. Journal of Official Statistics,
19(1), p.1-16.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonathan Bartlett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
