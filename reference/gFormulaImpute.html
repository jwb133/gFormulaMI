<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>G-formula multiple imputation — gFormulaImpute • gFormulaMI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="G-formula multiple imputation — gFormulaImpute"><meta name="description" content="gFormulaImpute creates multiple imputed synthetic datasets of longitudinal histories under
specified treatment regimes of interest, based on the G-formula."><meta property="og:description" content="gFormulaImpute creates multiple imputed synthetic datasets of longitudinal histories under
specified treatment regimes of interest, based on the G-formula."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gFormulaMI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gFormulaMI.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>G-formula multiple imputation</h1>

      <div class="d-none name"><code>gFormulaImpute.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>gFormulaImpute</code> creates multiple imputed synthetic datasets of longitudinal histories under
specified treatment regimes of interest, based on the G-formula.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gFormulaImpute</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  M <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  <span class="va">trtVars</span>,</span>
<span>  <span class="va">trtRegimes</span>,</span>
<span>  nSim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  micePrintFlag <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predictorMatrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  missingDataCheck <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The observed data frame</p></dd>


<dt id="arg-m">M<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>The number of imputed datasets to generate</p></dd>


<dt id="arg-trtvars">trtVars<a class="anchor" aria-label="anchor" href="#arg-trtvars"></a></dt>
<dd><p>A vector of variable names indicating the time-varying treatment variables</p></dd>


<dt id="arg-trtregimes">trtRegimes<a class="anchor" aria-label="anchor" href="#arg-trtregimes"></a></dt>
<dd><p>A vector specifying the treatment regime of interest, or a list of
vectors specifying the treatment regimes of interest</p></dd>


<dt id="arg-nsim">nSim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>The number of individuals to simulate in each imputed dataset. Defaults to
number of individuals in observed data</p></dd>


<dt id="arg-miceprintflag">micePrintFlag<a class="anchor" aria-label="anchor" href="#arg-miceprintflag"></a></dt>
<dd><p>TRUE/FALSE specifying whether the output from the call(s) to mice
should be printed</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>TRUE/FALSE indicating whether to print output to console (FALSE) or not (TRUE)</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>An optional method argument to pass to mice. If not specified, the default
is to impute continuous variables using normal linear regression (norm), binary variables using
logistic regression (logreg), polytomous regression for unordered factors and
proportional odds model for ordered factors</p></dd>


<dt id="arg-predictormatrix">predictorMatrix<a class="anchor" aria-label="anchor" href="#arg-predictormatrix"></a></dt>
<dd><p>An optional predictor matrix to specify which variables to use
as predictors in the imputation models. The default is to impute sequentially, i.e. impute
using all variables to the left of the variable being imputed as covariates</p></dd>


<dt id="arg-missingdatacheck">missingDataCheck<a class="anchor" aria-label="anchor" href="#arg-missingdatacheck"></a></dt>
<dd><p>TRUE/FALSE indicating whether <code>gFormulaMI</code> checks, when
passed a regular data frame, whether there any missing values.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>an S3 object of class mids (multiply imputed dataset)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>gFormulaImpute</code> creates multiple imputed synthetic datasets of longitudinal histories under
specified treatment regimes of interest, based on the G-formula, as described in
<a href="https://doi.org/10.1177/09622802251316971" class="external-link">Bartlett et al 2025</a>. Specifically, to
the observed data frame, an additional <code>nSim</code> rows are added in which all variables are set to
missing, except the time-varying treatment variables. The latter are set to the values
as specified in the <code>trtRegimes</code> argument. If multiple treatment regimes are specified,
<code>nSim</code> rows are added for each of the specified treatment regimes.</p>
<p><code>gFormulaImpute</code> uses the <code>mice</code> package to impute the potential outcome values of the
time-varying confounders and outcome in the synthetic datasets. Imputation is performed
sequentially from left to right in the data frame. As such, the variables must be ordered
in time in the input data frame, with the time-varying confounders at each time followed
by the corresponding treatment variable at that time.</p>
<p>For the data argument, <code>gFormulaImpute</code> expects either a fully observed (complete) data frame,
or else a set of multiple imputation stored in an object of class <code>mids</code> (from the <code>mice</code> package).</p>
<p>Unlike with Rubin's regular multiple imputation pooling rules, it is possible
for the pooling rules developed by Raghunathan et al (2003) to give negative
variance estimates. The probability of this occurring is reduced by increasing
<code>M</code> and/or <code>nSim</code>.</p>
<p><code>gFormulaImpute</code> returns an object of class <code>mids</code>. This can be analysed using the same
methods that imputed datasets from <code>mice</code> can be analysed with (see examples). However, Rubin's standard
pooling rules are not valid for analysis of the synthetic datasets. Instead, the synthetic
variance estimator of Raghunathan et al (2003) must be used, as implemented in the
<a href="syntheticPool.html">syntheticPool</a> function.</p>
<p>The development of the <code>gFormulaMI</code> package was supported by a grant from the UK
Medical Research Council (MR/T023953/1).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bartlett JW, Olarte Parra C, Granger E, Keogh RH., van Zwet EW
and Daniel RM, 2025. G-formula with multiple imputation for causal inference
with incomplete data. Statistical Methods in Medical Research.</p>
<p>Raghunathan TE, Reiter JP, Rubin DB. 2003. Multiple imputation for statistical
disclosure limitation. Journal of Official Statistics, 19(1), p.1-16.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jonathan Bartlett <a href="mailto:jonathan.bartlett1@lshtm.ac.uk">jonathan.bartlett1@lshtm.ac.uk</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7626</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#impute synthetic datasets under two regimes of interest</span></span></span>
<span class="r-in"><span><span class="va">imps</span> <span class="op">&lt;-</span> <span class="fu">gFormulaImpute</span><span class="op">(</span>data<span class="op">=</span><span class="va">simDataFullyObs</span>,M<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                        trtVars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a0"</span>,<span class="st">"a1"</span>,<span class="st">"a2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        trtRegimes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Input data is a regular data frame."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Variables imputed using:"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     l0     a0     l1     a1     l2     a2      y regime </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> "norm"     "" "norm"     "" "norm"     "" "norm"     "" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Predictor matrix is set to:"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        l0 a0 l1 a1 l2 a2 y regime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l0      0  0  0  0  0  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a0      1  0  0  0  0  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l1      1  1  0  0  0  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a1      1  1  1  0  0  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l2      1  1  1  1  0  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a2      1  1  1  1  1  0 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y       1  1  1  1  1  1 0      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> regime  1  1  1  1  1  1 1      0</span>
<span class="r-in"><span><span class="co">#fit linear model to final outcome with regime as covariate</span></span></span>
<span class="r-in"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">imps</span>, <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">regime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#pool results using Raghunathan et al 2003 rules</span></span></span>
<span class="r-in"><span><span class="fu"><a href="syntheticPool.html">syntheticPool</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Estimate       Within     Between       Total       df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     -0.02071539 0.0008125695 0.001763004 0.001126735 3.038045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(regime)2  2.96593502 0.0016251389 0.004203106 0.002998278 3.784951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   95% CI L   95% CI U            p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)     -0.1267874 0.08535658 5.803156e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(regime)2  2.8104386 3.12143146 1.304839e-06</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonathan Bartlett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

